Sys.setenv(LANGUAGE='en')
options(strinngAsFactors = FALSE)
rm(list = ls())

setwd()
library(Seurat)
library(tidyverse)
library(dplyr)
library(patchwork)
library(ggplot2)

#读取某路径下的所有文件：利用Read10X函数的特性（目录下所有的，并且根据vector的名字直接命名barcode）
dir = c("young_1/","old_1")
names(dir) = c("young","old")
dir
scRNA.all = Read10X(data.dir = dir)
scRNA = CreateSeuratObject(scRNA.all,min.cells = 3, min.features = 40)
#table查看分类，交替使用@$符号进行对V4对象的提取，差异分析中也用到deq？
table(scRNA@meta.data$orig.ident)
#质控包括去除低质量细胞和双细胞，前者包括总测序深度、线粒体基因比例等
?PercentageFeatureSet
#正则表达式，grep函数的使用，线粒体基因命名的规范 MT-
scRNA[["precent.mt"]] = PercentageFeatureSet(scRNA, pattern = "^MT-")
#红细胞相关基因 固定的？ 基因集 约为10个？ 一般细胞数量少，可以不做
#Feature 每个细胞中检测到的基因数，不可过少，总共2w+个基因
#Count 每个细胞总的UMI数，可以理解为测序深度。类似所有基因的reads？
#根据小提琴图，确定阈值选择，一般线粒体基因<20%,nFeature_RNA > 300 & nFeature_RNA < 7000,
scRNA_QC = subset(scRNA, subset = nFeature_RNA > 300 & nFeature_RNA < 7000 & precent.mt <20 & nCount_RNA >1000)
#细胞数量得到下降
?NormalizeData
#表达量x10000/total UMI +1 后 取ln、
scRNA_QC = NormalizeData(scRNA_QC, normalization.method = "LogNormalize",
                         scale.factor = 10000 )
